groups:
  - name: "Story Node Alerts"
    interval: 1m
    rules:
      - alert: NodeSyncing
        expr: cometbft_blocksync_syncing == 1
        for: 1m
        labels:
          severity: critical
          alert_source: story
        annotations:
          summary: "Node is syncing"
          description: "The Story node is currently not synchronized."

      - alert: LowPeerCount
        expr: cometbft_p2p_peers < 9
        for: 1m
        labels:
          severity: warning
          alert_source: story
        annotations:
          summary: "Peers below 9"
          description: "The number of connected peers is below 9."

      - alert: LowValidatorPower
        expr: cometbft_consensus_validator_power{validator_address="7FBE0E10EF7E41CEECC598AB43195F84B6DC517F"} < 1024000
        for: 1m
        labels:
          severity: critical
          alert_source: story
        annotations:
          summary: "Validator power is low"
          description: "Validator power has fallen below the threshold."

      - alert: NodeSynchronized
        expr: cometbft_blocksync_syncing == 0
        for: 1m
        labels:
          severity: info
          alert_source: story
        annotations:
          summary: "Node Status: ✅ Synchronized"
          description: |
            The Story node is synchronized.
            Latest Block Height: {{ with query "cometbft_consensus_latest_block_height" }}{{ . | first | value }}{{ end }}

      - alert: NodeNotSynchronized
        expr: cometbft_blocksync_syncing == 1
        for: 1m
        labels:
          severity: info
          alert_source: story
        annotations:
          summary: "Node Status: ⚠️ Not Synchronized"
          description: |
            The Story node is not synchronized.
            Please check the sync process and peer connectivity.

      - alert: NodeHeartbeat
        expr: vector(1)
        for: 0s
        labels:
          severity: info
          alert_source: story
        annotations:
          summary: "🕒 Node Story Heartbeat"
          description: |
            Node is reachable.
            Sync: {{ with query "cometbft_blocksync_syncing" }}{{ . | first | value }}{{ end }}
            Latest Block Height: {{ with query "cometbft_consensus_latest_block_height" }}{{ . | first | value }}{{ end }}